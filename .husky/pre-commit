#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run linting
npm run lint

# Run streak tests if any related files changed
STREAK_FILES=$(git diff --cached --name-only | grep -E "(gamification|update-analytics|job-queue|process-queued-jobs)" || true)

if [ -n "$STREAK_FILES" ]; then
  echo "📊 Streak-related files changed, running streak tests..."
  npm run test:unit -- --run tests/unit/streak

  if [ $? -ne 0 ]; then
    echo "❌ Streak tests failed! Fix before committing."
    exit 1
  fi

  echo "✅ Streak tests passed!"
fi
